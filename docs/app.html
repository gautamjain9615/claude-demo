<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bookstore</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; }

    header {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: white; padding: 1.5rem 2rem;
      display: flex; justify-content: space-between; align-items: center;
    }
    header h1 { font-size: 1.5rem; font-weight: 600; }
    header nav a { color: rgba(255,255,255,0.7); text-decoration: none; margin-left: 1.5rem; font-size: 0.9rem; }
    header nav a:hover { color: white; }

    .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }

    .add-section {
      background: white; border-radius: 12px; padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 2rem;
    }
    .add-section h2 { font-size: 1rem; margin-bottom: 1rem; color: #555; }
    .form-row { display: flex; gap: 0.75rem; flex-wrap: wrap; }
    .form-row input {
      flex: 1; min-width: 150px; padding: 0.6rem 0.8rem;
      border: 1px solid #ddd; border-radius: 8px; font-size: 0.9rem;
      outline: none; transition: border 0.2s;
    }
    .form-row input:focus { border-color: #4a6cf7; }
    .form-row input[type="number"] { max-width: 120px; }
    .btn {
      padding: 0.6rem 1.2rem; border: none; border-radius: 8px;
      font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: all 0.2s;
    }
    .btn-primary { background: #4a6cf7; color: white; }
    .btn-primary:hover { background: #3a5ce5; }
    .btn-primary:disabled { background: #aaa; cursor: not-allowed; }

    .status { padding: 0.5rem 0; font-size: 0.85rem; min-height: 1.5rem; }
    .status.error { color: #e74c3c; }
    .status.success { color: #27ae60; }

    .books-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1rem; }
    .book-card {
      background: white; border-radius: 12px; padding: 1.25rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08); transition: transform 0.2s, box-shadow 0.2s;
    }
    .book-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
    .book-card .title { font-size: 1rem; font-weight: 600; margin-bottom: 0.3rem; }
    .book-card .author { font-size: 0.85rem; color: #777; margin-bottom: 0.75rem; }
    .book-card .price {
      display: inline-block; background: #e8f4e8; color: #27ae60;
      padding: 0.25rem 0.6rem; border-radius: 20px; font-size: 0.85rem; font-weight: 500;
    }
    .book-card .card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .book-card .id-badge {
      background: #f0f0f0; color: #999;
      padding: 0.15rem 0.5rem; border-radius: 12px; font-size: 0.75rem;
    }
    .btn-delete {
      background: none; border: 1px solid #e74c3c; color: #e74c3c;
      padding: 0.2rem 0.6rem; border-radius: 6px; font-size: 0.75rem;
      cursor: pointer; transition: all 0.2s;
    }
    .btn-delete:hover { background: #e74c3c; color: white; }

    .empty { text-align: center; padding: 3rem; color: #999; }
    .loading { text-align: center; padding: 2rem; color: #999; }

    @media (max-width: 600px) {
      .form-row { flex-direction: column; }
      .form-row input[type="number"] { max-width: none; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Bookstore</h1>
    <nav>
      <a href="index.html">API Docs</a>
    </nav>
  </header>

  <div class="container">
    <div class="add-section">
      <h2>Add a Book</h2>
      <div class="form-row">
        <input type="text" id="title" placeholder="Title">
        <input type="text" id="author" placeholder="Author">
        <input type="number" id="price" placeholder="Price" step="0.01" min="0">
        <button class="btn btn-primary" id="addBtn" onclick="addBook()">Add</button>
      </div>
      <div class="status" id="status"></div>
    </div>

    <div id="books" class="loading">Loading books...</div>
  </div>

  <script>
    // RENDER_API_BASE is replaced at deploy time; falls back to relative path for local dev.
    const RENDER_HOST = "RENDER_URL";
    const API_BASE = (RENDER_HOST !== "RENDER" + "_URL")
      ? "https://" + RENDER_HOST
      : "";

    async function loadBooks() {
      const container = document.getElementById("books");
      try {
        const res = await fetch(API_BASE + "/api/books");
        const books = await res.json();

        if (!books || books.length === 0) {
          container.innerHTML = '<div class="empty">No books yet. Add one above!</div>';
          return;
        }

        container.className = "books-grid";
        container.innerHTML = books.map(b => `
          <div class="book-card">
            <div class="card-top">
              <span class="id-badge">#${b.id}</span>
              <button class="btn-delete" onclick="deleteBook('${b.id}')">Delete</button>
            </div>
            <div class="title">${esc(b.title)}</div>
            <div class="author">${esc(b.author)}</div>
            <span class="price">$${Number(b.price).toFixed(2)}</span>
          </div>
        `).join("");
      } catch (err) {
        container.innerHTML = '<div class="empty">Could not load books. Is the API running?</div>';
      }
    }

    async function addBook() {
      const title = document.getElementById("title").value.trim();
      const author = document.getElementById("author").value.trim();
      const price = parseFloat(document.getElementById("price").value);
      const status = document.getElementById("status");
      const btn = document.getElementById("addBtn");

      if (!title || !author || isNaN(price)) {
        status.className = "status error";
        status.textContent = "Please fill in all fields.";
        return;
      }

      btn.disabled = true;
      try {
        const res = await fetch(API_BASE + "/api/books", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ title, author, price })
        });

        if (!res.ok) throw new Error("Failed to add book");

        status.className = "status success";
        status.textContent = `Added "${title}" successfully!`;
        document.getElementById("title").value = "";
        document.getElementById("author").value = "";
        document.getElementById("price").value = "";
        loadBooks();
      } catch (err) {
        status.className = "status error";
        status.textContent = "Failed to add book. Check the API connection.";
      } finally {
        btn.disabled = false;
      }
    }

    async function deleteBook(id) {
      const status = document.getElementById("status");
      try {
        const res = await fetch(API_BASE + "/api/books/" + id, { method: "DELETE" });

        if (!res.ok) throw new Error("Failed to delete book");

        status.className = "status success";
        status.textContent = "Book deleted.";
        loadBooks();
      } catch (err) {
        status.className = "status error";
        status.textContent = "Failed to delete book.";
      }
    }

    function esc(s) {
      const d = document.createElement("div");
      d.textContent = s;
      return d.innerHTML;
    }

    // Allow Enter key to submit.
    document.addEventListener("keydown", e => {
      if (e.key === "Enter" && ["title", "author", "price"].includes(e.target.id)) addBook();
    });

    loadBooks();
  </script>
</body>
</html>
